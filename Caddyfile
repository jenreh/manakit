:{$PORT}

encode gzip

# Backend API and Reflex endpoints proxied to the app on :3030
@backend_routes path /_event /_event/* /_events /_events/* /_state /_state/* /ping /_upload /_upload/* /docs /docs/*
handle @backend_routes {
    reverse_proxy http://localhost:3030 {
        # Let the backend know the original request was HTTPS at the edge
        header_up X-Forwarded-Proto "https"
        header_up X-Forwarded-Host {host}
        header_up X-Forwarded-Port "443"
    }
}

# Static site (SPA) from Reflex export
root * /srv
route {
    try_files {path} {path}/ /index.html
    file_server
}
